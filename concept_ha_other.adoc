---
sidebar: sidebar 
permalink: concept_ha_other.html 
keywords: ontap select, ha, high availability, disk heartbeating, heartbeating, mailbox, failover, giveback 
summary: HA磁碟心跳轉、HA信箱、HA心跳轉、HA容錯移轉及還原等功能、可強化資料保護。 
---
= ONTAP Select HA 可強化資料保護
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
高可用度（ HA ）磁碟心跳， HA 信箱， HA 心跳， HA 容錯移轉和 Giveback 工作，以強化資料保護。



== 磁碟心跳

雖然這個架構運用了許多傳統的指令碼路徑、但仍存在一些例外情況。ONTAP Select FAS其中一項例外是執行磁碟型心率、這是叢集節點用來防止網路隔離造成腦分割行為的非網路型通訊方法。分割腦部案例是叢集分割的結果、通常是網路故障所造成、因此每一方都認為另一方已停機、並嘗試接管叢集資源。

企業級HA實作必須妥善處理這類案例。透過客製化的磁碟型心跳法來達成此目標。ONTAP這是HA信箱的工作、這是叢集節點用來傳遞活動訊號訊息的實體儲存設備位置。這有助於叢集判斷連線能力、因此可在容錯移轉時定義仲裁。

在使用共享儲存HA架構的不同時陣列上、用下列方法解決大腦分裂問題：FAS ONTAP

* SCSI持續保留
* 持續HA中繼資料
* 透過HA互連傳送HA狀態


然而ONTAP Select 、在不共用的架構中、節點只能看到自己的本機儲存設備、而無法看到HA合作夥伴的儲存設備。因此、當網路分割區隔離HA配對的每一端時、就無法使用先前的判斷叢集仲裁和容錯移轉行為的方法。

雖然無法使用現有的分割腦偵測和避免方法、但仍需要一種協調方法、這種方法符合共享無事環境的限制。利用NetApp技術、可進一步擴充現有的信箱基礎架構、在網路分割的情況下、也能做為中繼方法。ONTAP Select由於共享儲存設備無法使用、因此透過NAS存取信箱磁碟來完成中繼作業。這些磁碟會使用iSCSI傳輸協定散佈到整個叢集、包括雙節點叢集中的中介器。因此、叢集節點可根據對這些磁碟的存取來做出智慧型容錯移轉決策。如果某個節點可以存取HA合作夥伴以外其他節點的信箱磁碟、則可能正常運作。


NOTE: 信箱架構和以磁碟為基礎的核心跳轉方法來解決叢集仲裁和腦分割問題、是ONTAP Select 導致多節點變體需要四個獨立節點、或是兩節點叢集的中介器的原因。



== HA信箱張貼

HA信箱架構使用訊息POST模式。叢集節點會以重複的時間間隔、將訊息張貼到叢集內的所有其他信箱磁碟、包括中介器、說明節點已啟動且正在執行。在健全的叢集內、叢集節點上的單一信箱磁碟會在任何時間點張貼來自所有其他叢集節點的訊息。

附加至每個Select叢集節點的虛擬磁碟是專供共用信箱存取使用的磁碟。此磁碟稱為中介信箱磁碟、因為它的主要功能是在節點故障或網路分割時做為叢集中繼的方法。此信箱磁碟包含每個叢集節點的分割區、並由其他Select叢集節點透過iSCSI網路掛載。這些節點會定期將健全狀況狀態張貼到信箱磁碟的適當分割區。使用分散於整個叢集的網路存取信箱磁碟、可讓您透過可到達性對照表來推斷節點健全狀況。例如、叢集節點A和B可以POST至叢集節點D的信箱、但不能POST至節點C的信箱此外、叢集節點D無法POST至節點C的信箱、因此節點C可能已停機或是網路已隔離、因此應該接管。



== HA令人心碎

如同NetApp FAS 的支援平台、ONTAP Select VMware會定期透過HA互連傳送HA活動訊息。在這個叢集內ONTAP Select 、這是透過HA合作夥伴之間存在的TCP/IP網路連線來執行。此外、磁碟型的活動訊號訊息會傳遞至所有HA信箱磁碟、包括中介信箱磁碟。這些訊息會每隔幾秒傳遞一次、並定期讀取。發送和接收這些訊號的頻率可讓ONTAP Select 故障叢集在約15秒內偵測HA故障事件、FAS 而這個視窗可在各個平台上使用。當不再讀取活動訊息時、會觸發容錯移轉事件。

下圖顯示從單ONTAP Select 一的故障叢集節點C的觀點、透過HA互連磁碟和中介磁碟傳送和接收訊號訊息的程序


NOTE: 網路訊號會透過HA互連傳送至HA合作夥伴節點D、而磁碟訊號則會在所有叢集節點、A、B、C和D之間使用信箱磁碟

*在四節點叢集中執行HA資料中心：穩定狀態*image:DDHA_05.jpg["在四節點叢集中執行HA執行資料移轉：穩定狀態"]



== HA容錯移轉與還原

在容錯移轉作業期間、正常運作的節點會使用HA合作夥伴資料的本機複本、承擔對等節點的資料服務責任。用戶端I/O可以不中斷地繼續運作、但必須先複寫此資料的變更、才能進行還原。請注意ONTAP Select 、由於這會導致儲存在存續節點上的變更遺失、所以不支援強制恢復。

重新開機的節點重新加入叢集時、會自動觸發同步處理回復作業。同步回溯所需的時間取決於多項因素。這些因素包括必須複寫的變更數目、節點之間的網路延遲、以及每個節點上磁碟子系統的速度。同步處理回饋所需的時間可能超過自動回饋10分鐘。在這種情況下、需要在同步回溯後手動恢復。您可以使用下列命令來監控同步處理回復的進度：

[listing]
----
storage aggregate status -r -aggregate <aggregate name>
----